<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Adicionar Produto - ML Fashion</title>
  <link rel="stylesheet" href="styleADP.css" />
</head>
<body>
  <header>
    <h1>Adicionar Produto</h1>
    <p>ML Fashion - Moda Cristã e Casual</p>
  </header>

  <main>
    <form id="formProduto">
      <label for="nome">Nome do Produto</label>
      <input type="text" id="nome" name="nome" required />

      <label for="preco">Preço</label>
      <input type="text" id="preco" name="preco" required placeholder="R$ 0,00" />

      <label for="imagemArquivo">Imagem do Produto</label>
      <input type="file" id="imagemArquivo" name="imagemArquivo" accept="image/*" required />

      <button type="submit" class="pedido-btn">Adicionar Produto</button>
    </form>

    <h2>Produtos Adicionados</h2>
    <div id="listaProdutos"></div>

    <div class="nav-button">
      <button class="pedido-btn" onclick="window.location.href='index.html'">Voltar para o Início</button>
    </div>
  </main>

  <script>
    const precoInput = document.getElementById("preco");

    precoInput.addEventListener("input", function () {
      let valor = this.value.replace(/\D/g, "");
      if (!valor) {
        this.value = "";
        return;
      }
      valor = String(Number(valor));
      while (valor.length < 3) {
        valor = "0" + valor;
      }
      let inteiro = valor.slice(0, -2);
      let centavos = valor.slice(-2);
      inteiro = inteiro.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
      this.value = `R$ ${inteiro},${centavos}`;
    });

    function salvarProduto(produto) {
      let produtos = JSON.parse(localStorage.getItem("produtos")) || [];
      produtos.push(produto);
      localStorage.setItem("produtos", JSON.stringify(produtos));
    }

    function removerProduto(index) {
      let produtos = JSON.parse(localStorage.getItem("produtos")) || [];
      produtos.splice(index, 1);
      localStorage.setItem("produtos", JSON.stringify(produtos));
      carregarLista();
    }

    function carregarLista() {
      const lista = document.getElementById("listaProdutos");
      lista.innerHTML = "";
      let produtos = JSON.parse(localStorage.getItem("produtos")) || [];

      produtos.forEach((produto, index) => {
        const item = document.createElement("div");
        item.className = "produto-item";

        item.innerHTML = `
          <img src="${produto.imagemBase64}" alt="${produto.nome}" />
          <div class="produto-info">
            <strong>${produto.nome}</strong><br>
            ${produto.preco}
          </div>
          <button onclick="removerProduto(${index})">Excluir</button>
        `;

        lista.appendChild(item);
      });
    }

    document.getElementById("formProduto").addEventListener("submit", function(e) {
      e.preventDefault();
      const nome = document.getElementById("nome").value;
      const preco = document.getElementById("preco").value;
      const imagemArquivo = document.getElementById("imagemArquivo").files[0];

      if (!imagemArquivo) {
        alert("Selecione uma imagem.");
        return;
      }

      const reader = new FileReader();
      reader.onload = function(event) {
        const imagemBase64 = event.target.result;
        const novoProduto = { nome, preco, imagemBase64 };
        salvarProduto(novoProduto);
        carregarLista();
        document.getElementById("formProduto").reset();
        document.querySelector("button[type='submit']").disabled = false; // Garante botão habilitado
      };
      reader.readAsDataURL(imagemArquivo);
    });

    window.onload = carregarLista;
  </script>
</body>
</html>
