<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Adicionar Produto - ML Fashion</title>
  <link rel="stylesheet" href="styleADP.css" />
</head>
<body>
  <header class="topo">
    <div class="logo">
      <h1>ML Fashion</h1>
      <p>Moda Cristã e Casual</p>
    </div>
  </header>

  <main class="main-content">
    <section class="catalogo">
      <h2>Adicionar Produto</h2>
      <form id="formProduto" enctype="multipart/form-data">
        <label for="nome">Nome do Produto</label>
        <input type="text" id="nome" name="nome" required />

        <label for="preco">Preço</label>
        <input type="text" id="preco" name="preco" required placeholder="R$ 0,00" />

        <label for="imagemArquivo">Imagem do Produto</label>
        <input type="file" id="imagemArquivo" name="imagemArquivo" accept="image/*" required />

        <button type="submit" class="pedido-btn">Adicionar Produto</button>
        <button type="button" class="pedido-btn" onclick="window.location.href='index.html'">Voltar para o Início</button>
      </form>

      <input type="text" id="buscaProduto" placeholder="Pesquisar produtos..." />

      <h2>Produtos Adicionados</h2>
      <div id="listaProdutos" class="produtos"></div>
    </section>
  </main>

  <footer>
    <div class="footer-container">
      <div class="footer-left">
        <h3>ML Fashion</h3>
        <p>Moda Cristã e Casual</p>
      </div>
      <div class="footer-center">
        <p>Contato: contato@mlfashion.com.br</p>
      </div>
      <div class="footer-right">
        <p>© 2025 ML Fashion</p>
      </div>
    </div>
  </footer>

<script>
  // Formatação do preço (igual seu código)
  function formatarPrecoInput(input) {
    input.addEventListener("input", function () {
      let valor = this.value.replace(/\D/g, "");
      if (!valor) {
        this.value = "";
        return;
      }
      valor = String(Number(valor));
      while (valor.length < 3) {
        valor = "0" + valor;
      }
      let inteiro = valor.slice(0, -2);
      let centavos = valor.slice(-2);
      inteiro = inteiro.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
      this.value = `R$ ${inteiro},${centavos}`;
    });
  }

  const precoInput = document.getElementById("preco");
  formatarPrecoInput(precoInput);

  // Função para carregar produtos do PHP
  async function carregarLista(filtrar = "") {
    const lista = document.getElementById("listaProdutos");
    lista.innerHTML = "Carregando produtos...";

    try {
      const response = await fetch(`buscar_produtos.php?busca=${encodeURIComponent(filtrar)}`);
      const produtos = await response.json();

      lista.innerHTML = "";

      if(produtos.length === 0) {
        lista.innerHTML = "<p>Nenhum produto encontrado.</p>";
        return;
      }

      produtos.forEach(produto => {
        const item = document.createElement("div");
        item.className = "produto";

        item.innerHTML = `
          <img src="${produto.imagem_url}" alt="${produto.nome}" />
          <h3>${produto.nome}</h3>
          <p>${produto.preco}</p>
        `;

        lista.appendChild(item);
      });
    } catch (error) {
      lista.innerHTML = "<p>Erro ao carregar produtos.</p>";
      console.error(error);
    }
  }

  // Evento do formulário para enviar produto ao PHP
  document.getElementById("formProduto").addEventListener("submit", async function(e) {
    e.preventDefault();

    const formData = new FormData(this);

    try {
      const response = await fetch('inserir_produto.php', {
        method: 'POST',
        body: formData
      });

      const result = await response.json();

      if(result.success) {
        alert('Produto adicionado com sucesso!');
        this.reset();
        carregarLista();
      } else {
        alert('Erro: ' + result.message);
      }
    } catch (error) {
      alert('Erro ao enviar dados.');
      console.error(error);
    }
  });

  // Pesquisa dinâmica
  document.getElementById("buscaProduto").addEventListener("input", function() {
    carregarLista(this.value);
  });

  // Carregar produtos ao abrir página
  window.onload = () => carregarLista();

</script>
</body>
</html>
